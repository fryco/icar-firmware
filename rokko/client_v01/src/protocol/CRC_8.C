#include "main.h"



/**************************************************************************************************
** 函数名: GS_CalcCrcSum
** 输　入: P_U8  OrigData, U8 Datalen
** 输　出: U8 ~CRC_8
** 功能描述:  本函数计算长度为 Datalen 的数据串 OrigData 的CRC_8 校验码
** 说  明:	void
** 作　者:  SIMPLE
** 日　期:  2005/05/17
** 修　改:  
** 日　期:  
** 版  本:  V0.0
**************************************************************************************************/
u8 crc8(u8 val,u8 crc) {

	u8 ii= 8;

  while(ii--) {
    if(((val ^ crc) & 0x80) != 0) {
      crc^= 0x0e;
      crc= (u8)((crc << 1) | 1);
      }
    else crc= (u8)(crc << 1);
    val= (u8)(val << 1);
    }
  return crc;
}

/**************************************************************************************************
** 函数名: AddCRC8
** 输　入: P_U8  OrigData
** 输　出: void
** 功能描述:  本函数计算长度为 Datalen 的数据串 OrigData 的CRC_8 校验码,并添加到数据串末尾，且长度+1
** 说  明:	void
** 作　者:  SIMPLE
** 日　期:  2005/05/17
** 修　改:  
** 日　期:  
** 版  本:  V0.0
//------------------------------------------------------------------------------
//
// SAE J1850 CRC: X8 + X4 + X3 + X2 + 1
//
//-----------------------------------------------------------------------------
**************************************************************************************************/

void AddCRC8(u8*  OrigData)
{
	u8* p;
	u8 CRC8 = 0xff,len;

	p = OrigData+1;
	len = OrigData[0];
	
  while(len--) CRC8= crc8(*(p++),CRC8);

  	p = OrigData;
    (*p) ++;
	*(p+*p) = (~CRC8);
	
}

//<=========================================END===================================================>

/*


*/
